# Loop Profiler

音楽ファイルのループポイントを自動検出し、プレビュー・エクスポートできるGUIアプリケーション。

## 機能

- **自動ループポイント検出**: pymusiclooperを使用したAI解析
- **波形表示**: リアルタイムでループ位置を可視化
- **ループプレビュー**: 検出されたループポイントを即座に試聴
- **柔軟なエクスポート**: イントロ・ループ・アウトロを自由に組み合わせてMP3出力
- **キャッシュ機能**: 一度解析した結果を保存し、次回から即座に読み込み
- **詳細情報表示**: 各ループポイントの開始時刻、終了時刻、ループ長を表示

## 必要要件

### システム要件

- Windows OS
- Python 3.8以上

### 必須ファイル

- `bass.dll` - BASS audio libraryのDLL（本プログラムと同じフォルダに配置）
  - [BASS公式サイト](https://www.un4seen.com/)からダウンロード可能

### 外部ツール

- `pymusiclooper` - コマンドラインツール（pipでインストール後、システムPATHに追加が必要）

## インストール

1. リポジトリをクローン

```bash
git clone <repository-url>
cd loop-profiler
```

2. 依存パッケージをインストール

```bash
pip install -r requirements.txt
```

3. `bass.dll`を入手し、`main.py`と同じフォルダに配置

4. `pymusiclooper`がシステムPATHに含まれていることを確認
```bash
pymusiclooper --version
```

## 使い方

1. アプリケーションを起動

```bash
python main.py
```

2. **SELECT AUDIO FILE**ボタンでMP3/WAV/OGGファイルを選択

3. **START ANALYSIS**ボタンで解析開始（初回のみ。2回目以降はキャッシュから自動読み込み）

4. リストから好みのループポイントをダブルクリックでプレビュー
   - スコア、開始時刻、終了時刻、ループ長、サンプル数が表示されます
   - ★マークは95%以上の高精度ループポイント

5. **EXPORT SETTINGS**でエクスポート設定を調整
   - **Intro**: ループ開始前の部分を含めるか
   - **Loop Section**: ループ区間を含めるか
   - **Outro**: ループ終了後の部分を含めるか
   - **Loop Repeat Count**: ループを何回繰り返すか（1〜100回）

6. **EXPORT TO MP3**ボタンで320kbps MP3として保存

## プロジェクト構成

```bash
loop-profiler/
├── main.py              # メインプログラム
├── bass.dll             # BASSライブラリ（要配置）
├── requirements.txt     # Python依存パッケージ
├── README.md           # このファイル
└── LooperOutput/       # 解析結果キャッシュ保存先（自動作成）
```

## UI説明

### 波形表示

- **青い波形**: 曲全体の波形
- **緑の点線（縦線）**: ループ開始位置とループ終了位置
- **緑の半透明エリア**: ループ区間
- **赤い縦線**: 現在の再生位置

### リスト表示

各ループ候補には以下の情報が表示されます：

- **SCORE**: ループの精度（95%以上は★マーク付き）
- **Start**: ループ開始時刻（分:秒.小数）
- **End**: ループ終了時刻（分:秒.小数）
- **Loop**: ループ区間の長さ（秒）
- **サンプル数**: ループ開始→終了のサンプル位置

### エクスポート設定プレビュー

選択したループポイントとエクスポート設定に基づいて、以下が表示されます：

- **Composition**: 各セクションの長さ
- **Total Duration**: 出力される曲の総時間

## トラブルシューティング

### `bass.dll not found`エラー

- `bass.dll`が`main.py`と同じフォルダにあるか確認してください

### `pymusiclooper`が見つからない

- コマンドプロンプトで`pymusiclooper --version`が動作するか確認
- 動作しない場合はPATHの設定を確認してください

### 波形表示がおかしい

- ファイルを選択し直すと正常に表示されることがあります
- 対応フォーマット（MP3/WAV/OGG）であることを確認してください

### エクスポート時のエラー

- 少なくとも1つのセクション（イントロ/ループ/アウトロ）が選択されているか確認
- ディスク容量が十分にあるか確認
- 保存先のパスに日本語や特殊文字が含まれていないか確認

### キャッシュをクリアしたい

- `LooperOutput`フォルダ内の`.txt`ファイルを削除してください
- 次回解析時に新しいキャッシュが作成されます

## ライセンス

このプロジェクトは個人・商用利用可能です。ただし以下の外部ライブラリのライセンスに従ってください：

- BASS audio library: [ライセンス条項](https://www.un4seen.com/)
- pymusiclooper: MIT License

## クレジット

- GUI: PyQt6
- 音声処理: BASS audio library, pydub
- ループ検出エンジン: pymusiclooper

## 変更履歴

### v1.0.0

- 初回リリース
- ループポイント自動検出機能
- 波形表示機能
- エクスポート機能（イントロ・ループ・アウトロの組み合わせ）
- キャッシュ機能
- 詳細情報表示（開始時刻、終了時刻、ループ長）
